<blockquote class="note">
  <p>操作功能前請先登入</p>
</blockquote>

<blockquote>
  <p>詳細功能請參考<a href="/pfcftest/API/fquote">API Reference/fquote</a></p>
</blockquote>

<blockquote>
  <p>範例<a href="/pfcftest/%E6%95%99%E5%AD%B8/sample/%E5%A4%96%E6%9C%9F%E8%A1%8C%E6%83%85%E7%AF%84%E4%BE%8B.ipynb">下載</a></p>
</blockquote>

<h2 id="查詢成交和最佳買賣價">查詢成交和最佳買賣價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#查詢成交和最佳買賣價範例
</span><span class="n">productid</span><span class="o">=</span><span class="s">'CME|NQ|202409|F|'</span> <span class="c1">#商品代碼
</span><span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>           
    <span class="n">display</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig3</span><span class="p">)</span>
    <span class="c1">#查詢成交價量
</span>    <span class="n">tickDataTradeResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdatatrade</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">tickdatatrade</span><span class="o">=</span><span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交時間'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatatrade</span><span class="p">.</span><span class="n">time</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">lastprice</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交量'</span><span class="p">]</span> <span class="p">]</span><span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">lastvolume</span>
        <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataTradeResponse '</span><span class="o">+</span><span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢最佳買價
</span>    <span class="n">tickDataBidResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdatabid</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataBidResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdatabid</span><span class="o">=</span><span class="n">tickDataBidResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價1'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM1Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量1'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM1Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價2'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM2Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量2'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM2Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價3'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM3Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量3'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM3Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價4'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM4Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量4'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM4Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價5'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM5Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量5'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM5Volume</span>                 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價6'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM6Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量6'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM6Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價7'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM7Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量7'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM7Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價8'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM8Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量8'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM8Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價9'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM9Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量9'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM9Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價10'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM10Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量10'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM10Volume</span>                                                              
        <span class="k">with</span> <span class="n">fig2</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataBidResponse '</span><span class="o">+</span><span class="n">tickDataBidResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢最佳賣價
</span>    <span class="n">tickDataOfferResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdataoffer</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataOfferResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdataOffer</span><span class="o">=</span><span class="n">tickDataOfferResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價1'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM1Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量1'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM1Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價2'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM2Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量2'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM2Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價3'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM3Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量3'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM3Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價4'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM4Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量4'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM4Volume</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價5'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM5Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量5'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM5Volume</span>                 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價6'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM6Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量6'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM6Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價7'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM7Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量7'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM7Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價8'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM8Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量8'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM8Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價9'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM9Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量9'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM9Volume</span>   
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價10'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM10Price</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量10'</span><span class="p">]]</span> <span class="o">=</span><span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM10Volume</span>                                                              
        <span class="k">with</span> <span class="n">fig3</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>             
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataOfferResponse '</span><span class="o">+</span><span class="n">tickDataOfferResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>      
</code></pre></div></div>
<h2 id="訂閱成交和最佳買賣價接收">訂閱成交和最佳買賣價接收</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 訂閱成交和最佳買賣價接收範例
</span><span class="n">productid</span><span class="o">=</span><span class="s">'CME|NQ|202409|F|'</span> <span class="c1">#商品代碼
#成交價量處理
</span><span class="k">def</span> <span class="nf">on_tickdatatrade</span><span class="p">(</span><span class="n">tickdatatrade</span><span class="p">:</span> <span class="n">FTickDataTrade</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">time</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">lastprice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">lastvolume</span>
    <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>
<span class="c1">#最佳買價處理
</span><span class="k">def</span> <span class="nf">on_tickdatabid</span><span class="p">(</span><span class="n">tickdatabid</span><span class="p">:</span> <span class="n">FTickDataBid</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM1Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM1Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM2Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM2Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM3Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM3Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM4Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM4Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM5Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM5Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價6'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM6Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量6'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM6Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價7'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM7Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量7'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM7Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價8'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM8Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量8'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM8Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價9'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM9Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量9'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM9Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買價10'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM10Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'買量10'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabid</span><span class="p">.</span><span class="n">BidDOM10Volume</span>
    <span class="k">with</span> <span class="n">fig2</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>
<span class="c1">#最佳賣價處理
</span><span class="k">def</span> <span class="nf">on_tickdataoffer</span><span class="p">(</span><span class="n">tickdataOffer</span><span class="p">:</span> <span class="n">FTickDataOffer</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM1Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM1Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM2Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM2Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM3Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM3Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM4Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM4Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM5Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM5Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價6'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM6Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量6'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM6Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價7'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM7Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量7'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM7Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價8'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM8Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量8'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM8Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價9'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM9Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量9'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM9Volume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣價10'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM10Price</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'賣量10'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataOffer</span><span class="p">.</span><span class="n">OfferDOM10Volume</span>
    <span class="k">with</span> <span class="n">fig3</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>


<span class="c1">#訂閱接收事件
</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdatatrade</span> <span class="o">=</span> <span class="n">on_tickdatatrade</span>
<span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdatabid</span> <span class="o">=</span> <span class="n">on_tickdatabid</span>
<span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdataoffer</span> <span class="o">=</span> <span class="n">on_tickdataoffer</span> 
<span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># 註冊報價
</span>    <span class="n">subok</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span>
        <span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊報價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>           
    <span class="n">display</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig3</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="查詢隱含-最高最低-開收盤-結算價">查詢隱含 最高最低 開收盤 結算價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#查詢隱含 最高最低 開收盤 結算價範例  
</span><span class="n">productid</span><span class="o">=</span><span class="s">'CME|NQ|202409|F|'</span> <span class="c1">#商品代碼
</span><span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
    <span class="n">display</span><span class="p">(</span><span class="n">fig4</span><span class="p">)</span>
    <span class="c1">#查詢隱含買賣價       
</span>    <span class="n">tickDataImpliedResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdataimplied</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataImpliedResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">tickdataimplied</span><span class="o">=</span><span class="n">tickDataImpliedResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含買價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedBidPrice</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含買量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedBidVolume</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含賣價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedOfferPrice</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含賣量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedOfferVolume</span> 
        <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataImpliedResponse '</span><span class="o">+</span><span class="n">tickDataImpliedResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢開收盤價
</span>    <span class="n">tickDataOpencloseResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdataopenclose</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataOpencloseResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">tickdataopenclose</span><span class="o">=</span><span class="n">tickDataOpencloseResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'開盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopenclose</span><span class="p">.</span><span class="n">Opening</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'收盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopenclose</span><span class="p">.</span><span class="n">Closing</span>  
        <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>                
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataOpencloseResponse '</span><span class="o">+</span><span class="n">tickDataOpencloseResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢最高最低價                   
</span>    <span class="n">tickDataHighLowResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdatahighlow</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataHighLowResponse</span><span class="p">.</span><span class="n">ok</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span> 
        <span class="n">tickdatahighlow</span><span class="o">=</span><span class="n">tickDataHighLowResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最高價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">High</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最低價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">Low</span>  
        <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>                 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataHighLowResponse '</span><span class="o">+</span><span class="n">tickDataHighLowResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢結算價            
</span>    <span class="n">tickDataSettleResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">query_tickdatasettle</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataSettleResponse</span><span class="p">.</span><span class="n">ok</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span> 
        <span class="n">tickdatasettle</span><span class="o">=</span><span class="n">tickDataSettleResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'目前結算價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatasettle</span><span class="p">.</span><span class="n">CurrStl</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最新結算價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatasettle</span><span class="p">.</span><span class="n">NewStl</span>  
        <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>           
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'tickDataSettleResponse '</span><span class="o">+</span><span class="n">tickDataSettleResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>          
</code></pre></div></div>
<h2 id="註冊隱含-最高最低-開收盤-結算價">註冊隱含 最高最低 開收盤 結算價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 註冊隱含 最高最低 開收盤 結算價 接收範例
</span><span class="n">productid</span><span class="o">=</span><span class="s">'CME|NQ|202409|F|'</span> <span class="c1">#商品代碼
#隱含買賣價接收處理
</span><span class="k">def</span> <span class="nf">on_tickdataimplied</span><span class="p">(</span><span class="n">ticksataimplied</span><span class="p">:</span> <span class="n">FTickDataImplied</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含買價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedBidPrice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含買量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedBidVolume</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含賣價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedOfferPrice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'隱含賣量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataimplied</span><span class="p">.</span><span class="n">ImpliedOfferVolume</span>
    <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>

<span class="c1">#最高最低價接收處理
</span><span class="k">def</span> <span class="nf">on_tickdatahighlow</span><span class="p">(</span><span class="n">tickdatahighlow</span><span class="p">:</span> <span class="n">FTickDataHighLow</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最高價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">High</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最低價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">Low</span>
    <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>

<span class="c1">#開收盤價接收處理
</span><span class="k">def</span> <span class="nf">on_tickdataopenclose</span><span class="p">(</span><span class="n">tickdataopenclose</span><span class="p">:</span> <span class="n">FTickDataOpenclose</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'開盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopenclose</span><span class="p">.</span><span class="n">Opening</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'收盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopenclose</span><span class="p">.</span><span class="n">Closing</span>
    <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>

<span class="c1">#結算價接收處理
</span><span class="k">def</span> <span class="nf">on_tickdatasettle</span><span class="p">(</span><span class="n">tickdatasettle</span><span class="p">:</span> <span class="n">FTickDataSettle</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'目前結算價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatasettle</span><span class="p">.</span><span class="n">CurrStl</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col4_idx</span><span class="p">[</span><span class="s">'最新結算價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatasettle</span><span class="p">.</span><span class="n">NewStl</span>
    <span class="k">with</span> <span class="n">fig4</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig4</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>

<span class="c1">#訂閱接收事件
</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdataimplied</span> <span class="o">=</span> <span class="n">on_tickdataimplied</span>
<span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdatahighlow</span> <span class="o">=</span> <span class="n">on_tickdatahighlow</span>
<span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdataopenclose</span> <span class="o">=</span> <span class="n">on_tickdataopenclose</span>
<span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">on_tickdatasettle</span> <span class="o">=</span> <span class="n">on_tickdatasettle</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># 註冊報價
</span>    <span class="n">subok</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span>
        <span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊報價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig4</span><span class="p">)</span> 

</code></pre></div></div>
<h2 id="反註冊報價">反註冊報價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#反註冊報價
</span><span class="n">unsub_ok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">fquote</span><span class="p">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ym</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cp</span><span class="o">=</span> <span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strike</span><span class="o">=</span><span class="n">productid</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'反註冊報價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">unsub_ok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

