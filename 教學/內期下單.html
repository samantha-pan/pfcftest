<blockquote class="note">
  <p>操作功能前請先登入</p>
</blockquote>

<blockquote>
  <p>詳細說明請參考<a href="/pfcftest/API/dtrade">API Reference/dtrade</a></p>
</blockquote>

<blockquote>
  <p>範例<a href="/pfcftest/%E6%95%99%E5%AD%B8/sample/%E5%85%A7%E6%9C%9F%E5%A7%94%E8%A8%97%E7%AF%84%E4%BE%8B.ipynb">下載</a></p>
</blockquote>

<h2 id="訂閱委託回報事件">訂閱委託回報事件</h2>
<p>傳入DOrderReply物件</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#訂閱回報接收範例  
</span><span class="k">def</span> <span class="nf">on_reply</span><span class="p">(</span><span class="n">orderreply</span><span class="p">:</span> <span class="n">DOrderReply</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">reply_dd</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> 
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'分公司'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">brokerid</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'帳號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">investoracno</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'網路流水序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">networkid</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordertime</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託書號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderno</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'子帳'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">subact</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'商品類別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">productkind</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'商品代碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">productid</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'買賣別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">bs</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'價格別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordertype</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託價格'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">price</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderqty</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'未成交數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">nomatchqty</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">matchqty</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'刪除數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">delqty</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'下單方式'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordercondition</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'開倉別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">opencloseflag</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'異動時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">mdate</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託狀態'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderstatus</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託狀態碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">statuscode</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'開倉別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">opencloseflag</span>
    <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'下單序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">seq</span>  
<span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">on_reply</span><span class="o">=</span><span class="n">on_reply</span>
</code></pre></div></div>
<h2 id="訂閱成交回報事件">訂閱成交回報事件</h2>
<p>傳入DMatchReplyy物件</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">on_match</span><span class="p">(</span><span class="n">matchreply</span><span class="p">:</span> <span class="n">DMatchReply</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">reply_dd</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> 
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'分公司'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">brokerid</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'帳號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">investoracno</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'網路流水序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">networkid</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchtime</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'委託書號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">orderno</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'子帳'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">subact</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'商品類別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">productkind</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'商品代碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">productid</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'買賣別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">bs</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交價格'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchprice</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交口數'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchqty</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchseq</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交價1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchpricefoot1</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'成交價2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchpricefoot2</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'備註'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">note</span>
    <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s">'異動時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">mdate</span>  
<span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">on_match</span><span class="o">=</span><span class="n">on_match</span>  
</code></pre></div></div>

<h2 id="下單">下單</h2>
<p>請建立DOrderObject物件,透過dtrade.order執行</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#下單 
</span><span class="n">order</span> <span class="o">=</span> <span class="n">DOrderObject</span><span class="p">()</span>
<span class="n">order</span><span class="p">.</span><span class="n">actno</span> <span class="o">=</span> <span class="n">actno</span><span class="c1">#帳號
</span><span class="n">order</span><span class="p">.</span><span class="n">note</span> <span class="o">=</span> <span class="s">"ordertest"</span><span class="c1">#備註
</span><span class="n">order</span><span class="p">.</span><span class="n">subactno</span> <span class="o">=</span> <span class="s">""</span><span class="c1">#子帳
</span><span class="n">order</span><span class="p">.</span><span class="n">productid</span> <span class="o">=</span> <span class="s">"TXFF5"</span><span class="c1">#商品代號
</span><span class="n">order</span><span class="p">.</span><span class="n">bs</span> <span class="o">=</span> <span class="s">"B"</span><span class="c1">#買賣別B/S
</span><span class="n">order</span><span class="p">.</span><span class="n">ordertype</span> <span class="o">=</span> <span class="s">"M"</span><span class="c1">#L:限價 M:市價 P:範圍市價
</span><span class="n">order</span><span class="p">.</span><span class="n">price</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#委託價格
</span><span class="n">order</span><span class="p">.</span><span class="n">orderqty</span> <span class="o">=</span> <span class="mi">5</span><span class="c1">#數量
</span><span class="n">order</span><span class="p">.</span><span class="n">ordercondition</span> <span class="o">=</span> <span class="s">"R"</span><span class="c1">##委託種類 I:IOC R:ROD F:FOK
</span><span class="n">order</span><span class="p">.</span><span class="n">opencloseflag</span> <span class="o">=</span> <span class="s">""</span><span class="c1">##開倉別 str 0:新倉 1:平倉 空白:自動
</span><span class="n">order</span><span class="p">.</span><span class="n">dtrade</span><span class="o">=</span><span class="s">"N"</span><span class="c1">## Y:當沖 N:非當沖
</span><span class="n">orderresponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">" 是否成功 </span><span class="si">{</span><span class="n">orderresponse</span><span class="p">.</span><span class="n">issend</span><span class="si">}</span><span class="s"> 下單序號 </span><span class="si">{</span><span class="n">orderresponse</span><span class="p">.</span><span class="n">seq</span><span class="si">}</span><span class="s"> 錯誤代碼 </span><span class="si">{</span><span class="n">orderresponse</span><span class="p">.</span><span class="n">errorcode</span><span class="si">}</span><span class="s"> 錯誤訊息 </span><span class="si">{</span><span class="n">orderresponse</span><span class="p">.</span><span class="n">errormsg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="刪單">刪單</h2>
<p>請建立DReplaceObject,透過dtrade.replace_order執行</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#刪單 
</span><span class="n">replace</span><span class="o">=</span><span class="n">DReplaceObject</span><span class="p">()</span>
<span class="n">replace</span><span class="p">.</span><span class="n">replacetype</span><span class="o">=</span><span class="s">"4"</span><span class="c1">#4:取消, 5: 減量, m:改價"
</span><span class="n">replace</span><span class="p">.</span><span class="n">actno</span> <span class="o">=</span> <span class="n">actno</span><span class="c1">#帳號
</span><span class="n">replace</span><span class="p">.</span><span class="n">orderno</span><span class="o">=</span><span class="s">"P1ySr"</span><span class="c1">#委託書號
</span><span class="n">replaceresponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">replace_order</span><span class="p">(</span><span class="n">replace</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">" 是否成功 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">issend</span><span class="si">}</span><span class="s"> 下單序號 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">seq</span><span class="si">}</span><span class="s"> 錯誤代碼 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errorcode</span><span class="si">}</span><span class="s"> 錯誤訊息 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errormsg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="減量">減量</h2>
<p>請建立DReplaceObject,透過dtrade.replace_order執行</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#減量 
</span><span class="n">replace</span><span class="o">=</span><span class="n">DReplaceObject</span><span class="p">()</span>
<span class="n">replace</span><span class="p">.</span><span class="n">replacetype</span><span class="o">=</span><span class="s">"5"</span><span class="c1">#4:取消, 5: 減量, m:改價"
</span><span class="n">replace</span><span class="p">.</span><span class="n">actno</span> <span class="o">=</span><span class="n">actno</span><span class="c1">#帳號
</span><span class="n">replace</span><span class="p">.</span><span class="n">orderno</span><span class="o">=</span><span class="s">"P1ySr"</span><span class="c1">#委託書號
</span><span class="n">replace</span><span class="p">.</span><span class="n">orderqty</span> <span class="o">=</span> <span class="mi">1</span><span class="c1">#減量口數
</span><span class="n">replaceresponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">replace_order</span><span class="p">(</span><span class="n">replace</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">" 是否成功 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">issend</span><span class="si">}</span><span class="s"> 下單序號 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">seq</span><span class="si">}</span><span class="s"> 錯誤代碼 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errorcode</span><span class="si">}</span><span class="s"> 錯誤訊息 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errormsg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="改價">改價</h2>
<p>請建立DReplaceObject,透過dtrade.replace_order執行</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#改價 
</span><span class="n">replace</span><span class="o">=</span><span class="n">DReplaceObject</span><span class="p">()</span>
<span class="n">replace</span><span class="p">.</span><span class="n">replacetype</span><span class="o">=</span><span class="s">"m"</span><span class="c1">#4:取消, 5: 減量, m:改價"
</span><span class="n">replace</span><span class="p">.</span><span class="n">actno</span> <span class="o">=</span><span class="n">actno</span><span class="c1">#帳號
</span><span class="n">replace</span><span class="p">.</span><span class="n">orderno</span><span class="o">=</span><span class="s">"P1ySz"</span><span class="c1">#委託書號
</span><span class="n">replace</span><span class="p">.</span><span class="n">ordertype</span><span class="o">=</span><span class="s">"L"</span><span class="c1">#L:限價 M:市價 P:範圍市價
</span><span class="n">replace</span><span class="p">.</span><span class="n">ordercondition</span><span class="o">=</span><span class="s">"R"</span><span class="c1">#委託種類 I:IOC R:ROD F:FOK
</span><span class="n">replace</span><span class="p">.</span><span class="n">price</span><span class="o">=</span><span class="mi">22300</span><span class="c1">#委託價格
</span><span class="n">replaceresponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">replace_order</span><span class="p">(</span><span class="n">replace</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">" 是否成功 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">issend</span><span class="si">}</span><span class="s"> 下單序號 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">seq</span><span class="si">}</span><span class="s"> 錯誤代碼 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errorcode</span><span class="si">}</span><span class="s"> 錯誤訊息 </span><span class="si">{</span><span class="n">replaceresponse</span><span class="p">.</span><span class="n">errormsg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="委託查詢">委託查詢</h2>
<p>透過dtrade.query_reply執行查詢</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##委回查詢範例 
</span><span class="n">query_reply_response</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">query_reply</span><span class="p">(</span><span class="n">actno</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">)</span><span class="c1">#帳號,筆數,網路流水序號起,,網路流水序號迄,委託時間起,委託時間迄
</span><span class="k">print</span><span class="p">(</span><span class="n">query_reply_response</span><span class="p">)</span>
<span class="k">if</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">orderreply</span> <span class="ow">in</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">data</span><span class="p">:</span>  
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'分公司'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">brokerid</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'帳號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">investoracno</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'網路流水序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">networkid</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordertime</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託書號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderno</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'子帳'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">subact</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品類別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">productkind</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品代碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">productid</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'買賣別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">bs</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'價格別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordertype</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託價格'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">price</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderqty</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'未成交數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">nomatchqty</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">matchqty</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'刪除數量'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">delqty</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'下單方式'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">ordercondition</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'開倉別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">opencloseflag</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'異動時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">mdate</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託狀態'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">orderstatus</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託狀態碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">statuscode</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'開倉別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">opencloseflag</span>
            <span class="n">reply_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'下單序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">orderreply</span><span class="p">.</span><span class="n">seq</span>       
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  
        <span class="n">display</span><span class="p">(</span><span class="n">reply_dd</span><span class="p">)</span>               
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"查詢發生錯誤"</span><span class="o">+</span><span class="n">query_reply_response</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>          

</code></pre></div></div>
<h2 id="成交查詢">成交查詢</h2>
<p>透過dtrade.query_match執行查詢</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##成回查詢範例 
</span><span class="n">query_match_response</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dtrade</span><span class="p">.</span><span class="n">query_match</span><span class="p">(</span><span class="n">actno</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">)</span><span class="c1">#帳號,筆數,網路流水序號起,,網路流水序號迄,成交時間起,成交時間迄
</span><span class="k">if</span> <span class="n">query_match_response</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">matchreply</span> <span class="ow">in</span> <span class="n">query_match_response</span><span class="p">.</span><span class="n">data</span><span class="p">:</span>  
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'分公司'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">brokerid</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'帳號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">investoracno</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'網路流水序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">networkid</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchtime</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'委託書號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">orderno</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'子帳'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">subact</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品類別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">productkind</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品代碼'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">productid</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'買賣別'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">bs</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交價格'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchprice</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交口數'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchqty</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交序號'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchseq</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交價1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchpricefoot1</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'成交價2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">matchpricefoot2</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'備註'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">note</span>
            <span class="n">match_dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'異動時間'</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchreply</span><span class="p">.</span><span class="n">mdate</span>
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> 
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  
        <span class="n">display</span><span class="p">(</span><span class="n">match_dd</span><span class="p">)</span>         
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"查詢發生錯誤"</span><span class="o">+</span><span class="n">query_match_response</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>       
</code></pre></div></div>

