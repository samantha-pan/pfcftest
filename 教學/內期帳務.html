<blockquote class="note">
  <p>操作功能前請先登入</p>
</blockquote>

<blockquote>
  <p>詳細功能請參考<a href="/pfcftest/API/daccount">API Reference/daccount</a></p>
</blockquote>

<blockquote>
  <p>範例<a href="/pfcftest/%E6%95%99%E5%AD%B8/sample/%E5%85%A7%E6%9C%9F%E5%B8%B3%E5%8B%99%E7%AF%84%E4%BE%8B.ipynb">下載</a></p>
</blockquote>

<h2 id="保證金查詢">保證金查詢</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 保證金查詢範例
</span><span class="n">actno</span> <span class="o">=</span> <span class="s">'9808401'</span><span class="c1"># 使用帳號
# 初始數據
</span><span class="n">reply_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span>
               <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">''</span><span class="p">]]</span>
<span class="n">reply_dd</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reply_data</span><span class="p">)</span>
<span class="n">reply_dd</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'總筆數'</span><span class="p">,</span> <span class="s">'現在筆數'</span><span class="p">,</span> <span class="s">'網路序號'</span><span class="p">,</span> <span class="s">'公司別'</span><span class="p">,</span> <span class="s">'帳號'</span><span class="p">,</span> <span class="s">'帳務日期'</span><span class="p">,</span> <span class="s">'幣別'</span><span class="p">,</span> <span class="s">'匯率'</span><span class="p">,</span> <span class="s">'昨日權益數'</span><span class="p">,</span> <span class="s">'昨日餘額'</span><span class="p">,</span> <span class="s">'存提'</span><span class="p">,</span> <span class="s">'期貨平倉損益'</span><span class="p">,</span> <span class="s">'未沖銷期貨浮動損益'</span><span class="p">,</span> <span class="s">'選擇權平倉損益'</span><span class="p">,</span> <span class="s">'選擇權未平倉損益'</span><span class="p">,</span> <span class="s">'當日權利金支出收入'</span><span class="p">,</span> <span class="s">'成交手續費'</span><span class="p">,</span> <span class="s">'成交期交稅'</span><span class="p">,</span> <span class="s">'委託預扣權利金'</span><span class="p">,</span> <span class="s">'權益數'</span><span class="p">,</span> <span class="s">'委託預扣原始保證金'</span><span class="p">,</span> <span class="s">'原始保證金'</span><span class="p">,</span> <span class="s">'維持保證金'</span><span class="p">,</span>
                    <span class="s">'可動用(出金)保證金'</span><span class="p">,</span> <span class="s">'買方選擇權市值'</span><span class="p">,</span> <span class="s">'賣方選擇權市值'</span><span class="p">,</span> <span class="s">'權益總值'</span><span class="p">,</span> <span class="s">'原始比率'</span><span class="p">,</span> <span class="s">'維持比率'</span><span class="p">,</span> <span class="s">'清算比率'</span><span class="p">,</span> <span class="s">'台幣權益總值'</span><span class="p">,</span> <span class="s">'台幣原始比率'</span><span class="p">,</span> <span class="s">'台幣可動用(出金)保證金'</span><span class="p">,</span> <span class="s">'有價證券抵繳金額'</span><span class="p">,</span> <span class="s">'加收保證金'</span><span class="p">,</span> <span class="s">'風險指標'</span><span class="p">,</span> <span class="s">'資料更新日期'</span><span class="p">,</span> <span class="s">'資料更新時間'</span><span class="p">,</span> <span class="s">'有價證券評價價值'</span><span class="p">,</span> <span class="s">'到期履約損益'</span><span class="p">,</span> <span class="s">'交易總額度'</span><span class="p">,</span> <span class="s">'超額/追繳保證金'</span><span class="p">,</span> <span class="s">'資料來源類別'</span><span class="p">,</span> <span class="s">'夜盤收盤權益數'</span><span class="p">,</span> <span class="s">'夜盤風險指標'</span><span class="p">,</span> <span class="s">'夜盤權利總值'</span><span class="p">,</span> <span class="s">'夜盤原始保證金'</span><span class="p">,</span> <span class="s">'夜盤維持保證金'</span><span class="p">]</span>
<span class="c1">#查詢保證金
</span><span class="n">query_reply_response</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">daccount</span><span class="p">.</span><span class="n">get_margin</span><span class="p">(</span><span class="n">actno</span><span class="p">,</span> <span class="s">'NTT'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">data</span>
    <span class="n">new_row</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"總筆數"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">total_count</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"現在筆數"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">current_count</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"網路序號"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">network_id</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"公司別"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">company</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"帳號"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">actno</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"帳務日期"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">account_date</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"幣別"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">currency</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"匯率"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">exrate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"昨日權益數"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">lctdab</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"昨日餘額"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ltdab</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"存提"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">dwamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"期貨平倉損益"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">osprtlos</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"未沖銷期貨浮動損益"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">prtlos</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"選擇權平倉損益"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">optosprtlos</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"選擇權未平倉損益"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">optprtlos</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"當日權利金支出收入"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">tpremium</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"成交手續費"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">orignfee</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"成交期交稅"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ctaxamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"委託預扣權利金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ordpremium</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"權益數"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ctdab</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"委託預扣原始保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ordiamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"原始保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">iamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"維持保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">mamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"可動用(出金) 保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">ordcexcess</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"買方選擇權市值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">bpremium</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"賣方選擇權市值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">spremium</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"權益總值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">optequity</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"原始比率"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">inirate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"維持比率"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">matrate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"清算比率"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">liquidation_ratio</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"台幣權益總值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">twdoptequity</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"台幣原始比率"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">twdinirate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"台幣可動用(出金)保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">twdordexcess</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"有價證券抵繳金額"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">securities_payment_amount</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"加收保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">tmp1prices</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"風險指標"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">optrate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"資料更新日期"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">update_date</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"資料更新時間"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">update_time</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"有價證券評價價值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">securities_valuation</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"到期履約損益"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">excerciseprice</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"交易總額度"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">transaction_total_quota</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"超額/追繳保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">excess_margin</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"資料來源類別"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">data_source_type</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"夜盤收盤權益數"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">night_session_closing_ctdab</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"夜盤風險指標"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">night_session_optrate</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"夜盤權利總值"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">night_session_optequity</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"夜盤原始保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">night_session_iamt</span>
    <span class="n">new_row</span><span class="p">[</span><span class="s">"夜盤維持保證金"</span><span class="p">]</span> <span class="o">=</span> <span class="n">margin</span><span class="p">.</span><span class="n">night_session_mamt</span>
    <span class="n">reply_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">new_row</span>
    <span class="n">reply_dd</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reply_data</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">query_reply_response</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">reply_dd</span><span class="p">)</span>

</code></pre></div></div>
<h2 id="未平倉查詢">未平倉查詢</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 未平倉查詢範例
</span><span class="n">actno</span> <span class="o">=</span> <span class="s">'9808401'</span><span class="c1"># 使用帳號
# 初始數據
</span><span class="n">reply_data</span><span class="o">=</span><span class="p">[[</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">]]</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reply_data</span><span class="p">)</span>
<span class="n">dd</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'現在筆數'</span><span class="p">,</span><span class="s">'網路序號'</span><span class="p">,</span><span class="s">'公司別'</span><span class="p">,</span><span class="s">'帳號'</span><span class="p">,</span><span class="s">'商品代碼'</span><span class="p">,</span><span class="s">'買賣別'</span><span class="p">,</span><span class="s">'留倉口數'</span><span class="p">,</span><span class="s">'成交均價'</span><span class="p">,</span><span class="s">'即時價'</span><span class="p">,</span><span class="s">'浮動損益'</span><span class="p">,</span><span class="s">'交易稅'</span><span class="p">,</span><span class="s">'手續費'</span><span class="p">,</span><span class="s">'淨損益'</span><span class="p">,</span><span class="s">'腳一商品類別'</span><span class="p">,</span><span class="s">'腳一商品年月'</span><span class="p">,</span><span class="s">'腳一履約價'</span><span class="p">,</span><span class="s">'腳一買賣權'</span><span class="p">,</span><span class="s">'腳一買賣別'</span><span class="p">,</span><span class="s">'腳一成交均價'</span><span class="p">,</span><span class="s">'腳二商品類別'</span><span class="p">,</span><span class="s">'腳二商品年月'</span><span class="p">,</span><span class="s">'腳二履約價'</span><span class="p">,</span><span class="s">'腳二買賣權'</span><span class="p">,</span><span class="s">'腳二買賣別'</span><span class="p">,</span><span class="s">'腳二成交均價'</span><span class="p">,</span><span class="s">'商品名稱'</span><span class="p">,</span><span class="s">'腳一商品'</span><span class="p">,</span><span class="s">'腳二商品'</span><span class="p">,</span><span class="s">'複式單策略名稱'</span><span class="p">,</span><span class="s">'資料來源類別'</span><span class="p">]</span>
<span class="c1">#查詢未平倉
</span><span class="n">query_reply_response</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">daccount</span><span class="p">.</span><span class="n">get_unliquidation</span><span class="p">(</span><span class="n">actno</span><span class="p">,</span> <span class="s">'NTT'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">data</span><span class="p">:</span>  
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"現在筆數"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">current_count</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"網路序號"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">network_id</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"公司別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">company</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"帳號"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">actno</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"商品代碼"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">productid</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"買賣別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">bs</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"留倉口數"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">totalotqty</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"成交均價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">avgmatchprice</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"即時價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">realprice</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"浮動損益"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">reftotalpl</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"交易稅"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">ctaxamt</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"手續費"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">commission_fee</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"淨損益"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">net_profit_loss</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一商品類別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_product_category</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一商品年月"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_product_date</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一履約價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_strike_price</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一買賣權"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_call_put</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一買賣別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_buy_sell</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一成交均價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_average_price</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二商品類別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_product_category</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二商品年月"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_product_date</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二履約價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_strike_price</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二買賣權"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_call_put</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二買賣別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_buy_sell</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二成交均價"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_average_price</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"商品名稱"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">product_name</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳一商品"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg1_productid</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"腳二商品"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">leg2_productid</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"複式單策略名稱"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">multiname</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">"資料來源類別"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">data_source_type</span>  
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>  
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">query_reply_response</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> 

<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="即時部位查詢">即時部位查詢</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 即時部位查詢範例
</span><span class="n">actno</span> <span class="o">=</span> <span class="s">'9808401'</span><span class="c1"># 使用帳號
# 初始數據
</span><span class="n">reply_data</span><span class="o">=</span><span class="p">[[</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">,</span><span class="s">''</span><span class="p">]]</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reply_data</span><span class="p">)</span>
<span class="n">dd</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'現在筆數'</span><span class="p">,</span><span class="s">'網路序號'</span><span class="p">,</span><span class="s">'公司別'</span><span class="p">,</span><span class="s">'帳號'</span><span class="p">,</span><span class="s">'幣別'</span><span class="p">,</span><span class="s">'商品'</span><span class="p">,</span><span class="s">'月份'</span><span class="p">,</span><span class="s">'Call Put'</span><span class="p">,</span><span class="s">'履約價'</span><span class="p">,</span><span class="s">'前日買進留倉'</span><span class="p">,</span><span class="s">'前日賣出留倉'</span><span class="p">,</span><span class="s">'本日買進委託'</span><span class="p">,</span><span class="s">'本日賣出委託'</span><span class="p">,</span><span class="s">'本日買進成交'</span><span class="p">,</span><span class="s">'本日賣出成交'</span><span class="p">,</span><span class="s">'本日平倉'</span><span class="p">,</span><span class="s">'目前買進留倉'</span><span class="p">,</span><span class="s">'目前賣出留倉'</span><span class="p">,</span><span class="s">'組合買進餘額'</span><span class="p">,</span><span class="s">'組合賣出餘額'</span><span class="p">,</span><span class="s">'留倉買進平均成本'</span><span class="p">,</span><span class="s">'留倉賣出平均成本'</span><span class="p">,</span><span class="s">'買方原始保證金'</span><span class="p">,</span><span class="s">'賣方原始保證金'</span><span class="p">,</span><span class="s">'買方維持保證金'</span><span class="p">,</span><span class="s">'賣方維持保證金'</span><span class="p">,</span><span class="s">'商品基數'</span><span class="p">,</span><span class="s">'參考即時價'</span><span class="p">,</span><span class="s">'平倉損益'</span><span class="p">]</span>
<span class="c1">#查詢即時部位
</span><span class="n">query_reply_response</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">daccount</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">actno</span><span class="p">,</span> <span class="s">'NTT'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_reply_response</span><span class="p">.</span><span class="n">data</span><span class="p">:</span>  
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'現在筆數'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">current_count</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'網路序號'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">network_id</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'公司別'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">company</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'帳號'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">actno</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'幣別'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">currency</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">product</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'月份'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">month</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'Call Put'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">call_put</span>
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'履約價'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">strike_price</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'前日買進留倉'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">ot_qty_b</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'前日賣出留倉'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">ot_qty_s</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'本日買進委託'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">noworder_qty_b</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'本日賣出委託'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">noworder_qty_s</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'本日買進成交'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">nowmatch_qty_b</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'本日賣出成交'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">nowmatch_qty_s</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'本日平倉'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">today_close_position</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'目前買進留倉'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">current_buy_open_position</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'目前賣出留倉'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">current_sell_open_position</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'組合買進餘額'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">combined_buy_balance</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'組合賣出餘額'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">combined_sell_balance</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'留倉買進平均成本'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">open_buy_position_average_cost</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'留倉賣出平均成本'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">open_sell_position_average_cost</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'買方原始保證金'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">buyer_IAMT</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'賣方原始保證金'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">seller_IAMT</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'買方維持保證金'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">buyer_MAMT</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'賣方維持保證金'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">seller_MAMT</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'商品基數'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">product_base_number</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'參考即時價'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">reference_realPrice</span> 
        <span class="n">dd</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s">'平倉損益'</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="n">close_position_pnl</span> 
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>  
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">query_reply_response</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> 


</code></pre></div></div>
