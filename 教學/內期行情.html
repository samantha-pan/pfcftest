<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>內期行情 | Pfcfpy</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="內期行情" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="test" />
<meta property="og:description" content="test" />
<link rel="canonical" href="https://samantha-pan.github.io//pfcftest/%E6%95%99%E5%AD%B8/%E5%85%A7%E6%9C%9F%E8%A1%8C%E6%83%85" />
<meta property="og:url" content="https://samantha-pan.github.io//pfcftest/%E6%95%99%E5%AD%B8/%E5%85%A7%E6%9C%9F%E8%A1%8C%E6%83%85" />
<meta property="og:site_name" content="Pfcfpy" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="內期行情" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"test","headline":"內期行情","url":"https://samantha-pan.github.io//pfcftest/%E6%95%99%E5%AD%B8/%E5%85%A7%E6%9C%9F%E8%A1%8C%E6%83%85"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/pfcftest/assets/css/style.css?v=7db9096a95216000cbb2eed63ee94b5b154d2ebd">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/pfcftest/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="https://samantha-pan.github.io//pfcftest/">Pfcfpy</a></h1>
      

      <blockquote class="note">
  <p>操作功能前請先登入</p>
</blockquote>

<blockquote>
  <p>詳細功能請參考<a href="/pfcftest/API/dquote">API Reference/dquote</a></p>
</blockquote>

<blockquote>
  <p>範例<a href="/pfcftest/%E6%95%99%E5%AD%B8/sample/%E5%85%A7%E6%9C%9F%E8%A1%8C%E6%83%85%E7%AF%84%E4%BE%8B.ipynb">下載</a></p>
</blockquote>

<h2 id="查詢成交價">查詢成交價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#查詢成交和最佳買賣價接收範例  
</span><span class="n">productid</span><span class="o">=</span><span class="s">'TXFG4'</span><span class="c1">#商品代碼
</span><span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
     <span class="c1">#查詢開盤價量       
</span>    <span class="n">tickdataopenResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">query_tickdataopen</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tickdataopenResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdataopen</span><span class="o">=</span><span class="n">tickdataopenResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'開盤時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">opentime</span>        
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'開盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">openprice</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'開盤量'</span><span class="p">]</span> <span class="p">]</span><span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">openquantity</span> 
        <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>      
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"tickdataopen "</span><span class="o">+</span><span class="n">tickdataopenResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>    
    <span class="c1">#查詢成交價量 
</span>    <span class="n">tickDataTradeResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">query_tickdatatrade</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdatatrade</span><span class="o">=</span><span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchtime</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchprice</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchquantity</span> 
        <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"tickdatatrade "</span><span class="o">+</span><span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="c1">#查詢最高最低價
</span>    <span class="n">tickDataHignLowResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">query_tickdatahighlow</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataHignLowResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdatahighlow</span><span class="o">=</span><span class="n">tickDataHignLowResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'最高'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">dayhighprice</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'最低'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">daylowprice</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col2_idx</span><span class="p">[</span><span class="s">'最高低價時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">showtime</span>  
        <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>       
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"tickdatahighlow "</span><span class="o">+</span><span class="n">tickDataTradeResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>        
    <span class="c1">#查詢最佳買賣價量
</span>    <span class="n">tickDataBeforeBidOfferResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">query_tickdatabidoffer</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tickDataBeforeBidOfferResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tickdatabidoffer</span><span class="o">=</span><span class="n">tickDataBeforeBidOfferResponse</span><span class="p">.</span><span class="n">data</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp1</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq1</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp2</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq2</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp3</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq3</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp4</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq4</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp5</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq5</span>     
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp1</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq1</span>              
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp2</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq2</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp3</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq3</span>    
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp4</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq4</span>                
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp5</span>
        <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq5</span>        
        <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"tickdatabidoffer "</span><span class="o">+</span><span class="n">tickDataBeforeBidOfferResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
   
    
  
</code></pre></div></div>
<h2 id="註冊成交和最佳買賣價接收">註冊成交和最佳買賣價接收</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#註冊成交和最佳買賣價接收範例
</span><span class="n">productid</span><span class="o">=</span><span class="s">'TXFG4'</span><span class="c1">#商品代碼
#開盤價量接收處理
</span><span class="k">def</span> <span class="nf">on_tickdataopen</span><span class="p">(</span><span class="n">tickdataopen</span><span class="p">:</span> <span class="n">DTickDataOpen</span><span class="p">):</span>  
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'開盤時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">opentime</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'開盤價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">openprice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'開盤量'</span><span class="p">]</span> <span class="p">]</span><span class="o">=</span> <span class="n">tickdataopen</span><span class="p">.</span><span class="n">openquantity</span> 
    <span class="k">with</span> <span class="n">fig2</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span> 
<span class="c1">#成交價量接收處理        
</span><span class="k">def</span> <span class="nf">on_tickdatatrade</span><span class="p">(</span><span class="n">tickdatatrade</span><span class="p">:</span> <span class="n">DTickDataTrade</span><span class="p">):</span>  
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>  
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchtime</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交價'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchprice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'成交量'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatatrade</span><span class="p">.</span><span class="n">matchquantity</span> 
    <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span> 
<span class="c1">#最高最低價接收處理        
</span><span class="k">def</span> <span class="nf">on_tickdatahighlow</span><span class="p">(</span><span class="n">tickdatahighlow</span><span class="p">:</span> <span class="n">DTickDataHighLow</span><span class="p">):</span>    
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'最高'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">dayhighprice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'最低'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">daylowprice</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'最高低價時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatahighlow</span><span class="p">.</span><span class="n">showtime</span>  
    <span class="k">with</span> <span class="n">fig2</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig2</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>  
<span class="c1">#最佳買賣價量接收處理            
</span><span class="k">def</span> <span class="nf">on_tickdatabidoffer</span><span class="p">(</span><span class="n">tickdatabidoffer</span><span class="p">:</span> <span class="n">DTickDataBidOffer</span><span class="p">):</span>  
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp1</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq1</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp2</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq2</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp3</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq3</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp4</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq4</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bp5</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'買量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">bq5</span>     
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp1</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量1'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq1</span>              
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp2</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量2'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq2</span>    
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp3</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量3'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq3</span>    
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp4</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量4'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq4</span>                
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣價5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sp5</span>
    <span class="n">cur</span><span class="p">[</span><span class="n">col_idx</span><span class="p">[</span><span class="s">'賣量5'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tickdatabidoffer</span><span class="p">.</span><span class="n">sq5</span>        
    <span class="k">with</span> <span class="n">fig</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>
<span class="c1">#訂閱接收事件
</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">on_tickdataopen</span> <span class="o">=</span> <span class="n">on_tickdataopen</span>  
<span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">on_tickdatahighlow</span> <span class="o">=</span> <span class="n">on_tickdatahighlow</span>    
<span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">on_tickdatatrade</span> <span class="o">=</span> <span class="n">on_tickdatatrade</span>
<span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">on_tickdatabidoffer</span> <span class="o">=</span> <span class="n">on_tickdatabidoffer</span>   
<span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>       
    <span class="n">subok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">subscribe_tradebidoffer</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊成交買賣價量 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">subok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">subscribe_highlow</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊最高最低價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">subok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">subscribe_open</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊開收盤價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>    
    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">loginresponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> 
</code></pre></div></div>
<p>##反註冊成交和最佳買賣價接收</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#反註冊報價
</span><span class="n">unsub_ok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">unsubscribe_tradebidoffer</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'反註冊成交買賣價量 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">unsub_ok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">unsub_ok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">unsubscribe_highlow</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'反註冊最高最低價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">unsub_ok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">unsub_ok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">unsubscribe_open</span><span class="p">(</span><span class="n">productid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'反註冊開收盤價 </span><span class="si">{</span><span class="n">productid</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">unsub_ok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="查詢現貨價">查詢現貨價</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#查詢現貨價範例
</span><span class="n">index_id</span><span class="o">=</span><span class="s">'TXF'</span><span class="c1">#代碼
</span><span class="n">display</span><span class="p">(</span><span class="n">fig3</span><span class="p">)</span>
<span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
     <span class="c1">#查詢       
</span>    <span class="n">indexdataResponse</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">query_indexdata</span><span class="p">(</span><span class="n">index_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indexdataResponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">indexdata</span><span class="o">=</span><span class="n">indexdataResponse</span><span class="p">.</span><span class="n">data</span> 
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'現貨統計時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">indexdata</span><span class="p">.</span><span class="n">index_time</span>        
        <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'現貨價格'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">indexdata</span><span class="p">.</span><span class="n">index_value</span> 
        <span class="k">with</span> <span class="n">fig3</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
            <span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">indexdataResponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>     
</code></pre></div></div>

<h2 id="訂閱現貨價量接收">訂閱現貨價量接收</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#訂閱現貨價量接收範例
</span><span class="n">index_id</span><span class="o">=</span><span class="s">'TXF'</span> <span class="c1">#代碼
#接收現貨價量處理
</span><span class="k">def</span> <span class="nf">on_indexdata</span><span class="p">(</span><span class="n">indexdata</span><span class="p">:</span> <span class="n">DIndexData</span><span class="p">):</span> 
    <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">)</span> 
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'現貨統計時間'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">indexdata</span><span class="p">.</span><span class="n">index_time</span>        
    <span class="n">cur</span><span class="p">[</span><span class="n">col3_idx</span><span class="p">[</span><span class="s">'現貨價格'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">indexdata</span><span class="p">.</span><span class="n">index_value</span> 
    <span class="k">with</span> <span class="n">fig3</span><span class="p">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">fig3</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cells</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">cur</span>   
<span class="c1">#訂閱事件                 
</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">on_indexdata</span> <span class="o">=</span> <span class="n">on_indexdata</span>  
<span class="k">if</span> <span class="n">loginresponse</span><span class="p">.</span><span class="n">ok</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>      
    <span class="c1">#註冊報價        
</span>    <span class="n">subok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">subscribe_indexdata</span><span class="p">(</span><span class="s">'1'</span><span class="p">,</span><span class="n">index_id</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'註冊現貨價量 </span><span class="si">{</span><span class="n">index_id</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">subok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig3</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">loginresponse</span><span class="p">.</span><span class="n">error</span><span class="p">)</span> 
</code></pre></div></div>
<h2 id="反註冊現貨價接收">反註冊現貨價接收</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#反註冊現貨價接收
</span><span class="n">unsub_ok</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="n">api</span><span class="p">.</span><span class="n">dquote</span><span class="p">.</span><span class="n">unsubscribe_indexdata</span><span class="p">(</span><span class="s">'1'</span><span class="p">,</span><span class="n">index_id</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'反註冊現貨價量 </span><span class="si">{</span><span class="n">index_id</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">unsub_ok</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>



      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
